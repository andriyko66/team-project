<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <title>–õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞ —Ä–æ–±–æ—Ç–∞ ‚Äî Web App</title>

  <!-- ===============================
       –°–¢–ò–õ–Ü
  =============================== -->
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: #f4f4f4;
    }

    header {
      background-color: #222;
      color: white;
      padding: 15px;
      text-align: center;
    }

    nav {
      display: flex;
      justify-content: center;
      background-color: #333;
    }

    nav button {
      background: none;
      border: none;
      color: white;
      padding: 15px 20px;
      cursor: pointer;
      font-size: 16px;
    }

    nav button:hover {
      background-color: #555;
    }

    main {
      padding: 20px;
    }

    .page {
      display: none;
    }

    .page.active {
      display: block;
    }

    .card {
      background: white;
      padding: 15px;
      margin-bottom: 15px;
      border-radius: 6px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }

    .card h3 {
      margin-top: 0;
    }

    .btn {
      background-color: #007bff;
      color: white;
      border: none;
      padding: 8px 12px;
      cursor: pointer;
      border-radius: 4px;
    }

    .btn:hover {
      background-color: #0056b3;
    }

    input {
      padding: 6px;
      margin-right: 5px;
    }

    footer {
      text-align: center;
      padding: 15px;
      background-color: #222;
      color: white;
      margin-top: 30px;
    }
  </style>
</head>

<body>

<header>
  <h1>–ù–∞–≤—á–∞–ª—å–Ω–∏–π Web-–ø—Ä–æ—î–∫—Ç</h1>
  <p>Frontend + Backend (Express)</p>
</header>

<nav>
  <button onclick="showPage('home')">–ì–æ–ª–æ–≤–Ω–∞</button>
  <button onclick="showPage('items')">–¢–æ–≤–∞—Ä–∏</button>
  <button onclick="showPage('orders')">–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è</button>
  <button onclick="showPage('health')">–°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–µ—Ä–∞</button>
</nav>

<main>
  <!-- ===== HOME ===== -->
  <div id="home" class="page active">
    <div class="card">
      <h2>–í—ñ—Ç–∞—é üëã</h2>
      <p>–¶–µ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ–π–Ω–∏–π –≤–µ–±-–¥–æ–¥–∞—Ç–æ–∫ –¥–ª—è –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ—ó —Ä–æ–±–æ—Ç–∏.</p>
      <ul>
        <li>–ö—ñ–ª—å–∫–∞ —Å—Ç–æ—Ä—ñ–Ω–æ–∫</li>
        <li>–†–æ–±–æ—Ç–∞ –∑ API</li>
        <li>–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è —Ç–æ–≤–∞—Ä—ñ–≤</li>
        <li>–õ–æ–≥—ñ–∫–∞ –Ω–∞ JavaScript</li>
      </ul>
    </div>
  </div>

  <!-- ===== ITEMS ===== -->
  <div id="items" class="page">
    <h2>–°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä—ñ–≤</h2>
    <div id="itemsList"></div>
  </div>

  <!-- ===== ORDERS ===== -->
  <div id="orders" class="page">
    <h2>–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è</h2>
    <button class="btn" onclick="loadOrders()">–û–Ω–æ–≤–∏—Ç–∏ —Å–ø–∏—Å–æ–∫</button>
    <div id="ordersList" style="margin-top:10px;"></div>
  </div>

  <!-- ===== HEALTH ===== -->
  <div id="health" class="page">
    <h2>–°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–µ—Ä–∞</h2>
    <button class="btn" onclick="checkHealth()">–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏</button>
    <pre id="healthResult"></pre>
  </div>
</main>

<footer>
  <p>–õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞ —Ä–æ–±–æ—Ç–∞ ‚Ä¢ 2025</p>
</footer>

  <!-- ===== IDEMPOTENCY TEST ===== -->
<div id="idempotency" class="page">
  <h2>–¢–µ—Å—Ç —ñ–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—ñ</h2>

  <button class="btn" onclick="sendIdempotentOrder()">
    –í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ POST –∑ Idempotency-Key
  </button>

  <pre id="idemResult"></pre>
</div>


<!-- ===============================
     JAVASCRIPT
=============================== -->
<script>
const API_URL = "http://localhost:3000";

// –ù–∞–≤—ñ–≥–∞—Ü—ñ—è
function showPage(pageId) {
  document.querySelectorAll(".page").forEach(p => p.classList.remove("active"));
  document.getElementById(pageId).classList.add("active");

  if (pageId === "items") loadItems();
  if (pageId === "orders") loadOrders();
}

  <button onclick="showPage('idempotency')">–Ü–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω—ñ—Å—Ç—å</button>

// –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ç–æ–≤–∞—Ä—ñ–≤
async function loadItems() {
  const container = document.getElementById("itemsList");
  container.innerHTML = "–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...";

  try {
    const res = await fetch(`${API_URL}/items`);
    const items = await res.json();
    container.innerHTML = "";

    items.forEach(item => {
      const div = document.createElement("div");
      div.className = "card";
      div.innerHTML = `
        <h3>${item.name}</h3>
        <p>${item.description}</p>
        <p><b>–¶—ñ–Ω–∞:</b> ${item.price} –≥—Ä–Ω</p>
        <input type="number" min="1" value="1" id="qty-${item.id}">
        <button class="btn" onclick="createOrder('${item.id}')">–ó–∞–º–æ–≤–∏—Ç–∏</button>
      `;
      container.appendChild(div);
    });
  } catch (err) {
    container.innerHTML = `<p style="color:red;">–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ç–æ–≤–∞—Ä—ñ–≤: ${err}</p>`;
  }
}

// –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è
async function createOrder(itemId) {
  const qty = document.getElementById(`qty-${itemId}`).value;

  try {
    const res = await fetch(`${API_URL}/orders`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ itemId, quantity: Number(qty) })
    });
    const data = await res.json();

    if (res.ok) {
      alert(`–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–≤–æ—Ä–µ–Ω–æ. –°—É–º–∞: ${data.total} –≥—Ä–Ω`);
      loadOrders();
    } else {
      alert(`–ü–æ–º–∏–ª–∫–∞: ${data.error}`);
    }
  } catch (err) {
    alert("–ü–æ–º–∏–ª–∫–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è");
  }
}

// –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∑–∞–º–æ–≤–ª–µ–Ω—å
async function loadOrders() {
  const container = document.getElementById("ordersList");
  container.innerHTML = "–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...";

  try {
    const res = await fetch(`${API_URL}/orders`);
    const orders = await res.json();
    container.innerHTML = "";

    if (orders.length === 0) {
      container.innerHTML = "<p>–ó–∞–º–æ–≤–ª–µ–Ω—å —â–µ –Ω–µ–º–∞—î.</p>";
      return;
    }

    orders.forEach(order => {
      const div = document.createElement("div");
      div.className = "card";
      div.innerHTML = `
        <p><b>ID:</b> ${order.id}</p>
        <p><b>–¢–æ–≤–∞—Ä:</b> ${order.item.name}</p>
        <p><b>–ö—ñ–ª—å–∫—ñ—Å—Ç—å:</b> ${order.quantity}</p>
        <p><b>–°—É–º–∞:</b> ${order.total} –≥—Ä–Ω</p>
        <button class="btn deleteBtn" data-id="${order.id}">–í–∏–¥–∞–ª–∏—Ç–∏</button>
      `;
      container.appendChild(div);
    });

    // –ö–Ω–æ–ø–∫–∏ –≤–∏–¥–∞–ª–∏—Ç–∏
    document.querySelectorAll(".deleteBtn").forEach(btn => {
      btn.onclick = async () => {
        const id = btn.dataset.id;
        if (confirm("–í–∏–¥–∞–ª–∏—Ç–∏ —Ü–µ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è?")) {
          await fetch(`${API_URL}/orders/${id}`, { method: "DELETE" });
          loadOrders();
        }
      };
    });

  } catch (err) {
    container.innerHTML = `<p style="color:red;">–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∑–∞–º–æ–≤–ª–µ–Ω—å: ${err}</p>`;
  }
}

// Health check
async function checkHealth() {
  const result = document.getElementById("healthResult");
  result.textContent = "–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞...";
  try {
    const res = await fetch(`${API_URL}/health`);
    const data = await res.json();
    result.textContent = JSON.stringify(data, null, 2);
  } catch {
    result.textContent = "–ü–æ–º–∏–ª–∫–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞";
  }
}

  // ===== IDEMPOTENT POST =====
let idemKey = crypto.randomUUID(); // —Ç–æ–π —Å–∞–º–∏–π –∫–ª—é—á –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä—ñ

async function sendIdempotentOrder() {
  const output = document.getElementById("idemResult");
  output.textContent = "–í—ñ–¥–ø—Ä–∞–≤–∫–∞...";

  try {
    const res = await fetch(`${API_URL}/orders-idempotent`, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Idempotency-Key": idemKey
      },
      body: JSON.stringify({
        itemId: "1",
        quantity: 2
      })
    });

    const data = await res.json();

    output.textContent = JSON.stringify(data, null, 2);
  } catch (err) {
    output.textContent = "–ü–æ–º–∏–ª–∫–∞ –∑–∞–ø–∏—Ç—É";
  }
}


// –ê–≤—Ç–æ–∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
window.addEventListener("DOMContentLoaded", () => {
  loadItems();
  loadOrders();
});
</script>

</body>
</html>
